(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/payment/payment"],{1717:function(e,t,n){"use strict";var a=n("1a9c"),o=n.n(a);o.a},"1a9c":function(e,t,n){},"4cf6":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n("2f62");function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),a.forEach(function(t){s(e,t,n[t])})}return e}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var i={data:function(){return{hasAddress:!0,isWx:!1,isWebWx:!1,isWeb:!1,remark:"",payData:{},address:{},goodsList:[],balanceType:0,fee:0}},methods:{linkToCoupon:function(){e.redirectTo({url:"/pages/coupon/coupon"})},switchChange:function(e){this.balanceType=Number(e.detail.value)},handleWxPay:function(t){var n=this;this.$http.post("/mall/app/order/submit",o({},t,{payChannels:"8"})).then(function(a){1==a.result.orderState?(e.showToast({icon:"none",title:"订单提交成功"}),setTimeout(function(){e.redirectTo({url:"/pages/orderDetail/orderDetail"})},1e3)):n.$http.post("/mall/app/order/submit",o({},t,{payChannels:"8",callBackNo:a.result.orderNo})).then(function(e){wx.requestPayment({timeStamp:e.result.payResponse.wxPayResponse.timeStamp,nonceStr:e.result.payResponse.wxPayResponse.nonceStr,package:e.result.payResponse.wxPayResponse.packageStr,signType:e.result.payResponse.wxPayResponse.signType,paySign:e.result.payResponse.wxPayResponse.paySign,success:function(e){console.log(e)},fail:function(e){console.log(e)},complete:function(e){console.log(e)}})}).catch(function(e){console.log(e)})}).catch(function(e){console.log(e)})},handleWxWebPay:function(){},handleWebPay:function(t){var n=this;this.$http.post("/mall/app/order/submit",o({},t,{payChannels:"2"})).then(function(a){1==a.result.orderState?(e.showToast({icon:"none",title:"订单提交成功"}),setTimeout(function(){e.redirectTo({url:"/pages/orderDetail/orderDetail"})},1e3)):n.$http.post("/mall/app/order/submit",o({},t,{payChannels:"2",callBackNo:a.result.orderNo})).then(function(e){console.log(e)}).catch(function(e){console.log(e)})}).catch(function(e){console.log(e)})},handleSubmit:function(){this.hasAddress||e.showToast({icon:"none",title:"请先去创建地址"});var t=o({},this.baseInfo,{accountId:this.userInfo.accountId,addressId:this.address.addressId,balance:this.balancePay,isBalance:this.balanceType,credits:0,expressFee:this.payData.express.fee,goodsList:this.goodsList,payPrice:this.payPrice,remark:this.remark,totalPrice:this.payData.totalPrice});this.isWx?this.handleWxPay(t):this.isWebWx?this.handleWxWebPay(t):this.isWeb&&this.handleWebPay(t)},checkEnvironment:function(){navigator&&navigator.userAgent?this.browserRedirect():this.isWx=!0},browserRedirect:function(){var e=navigator.userAgent.toLowerCase(),t="ipad"==e.match(/ipad/i),n="iphone os"==e.match(/iphone os/i),a="midp"==e.match(/midp/i),o="rv:1.2.3.4"==e.match(/rv:1.2.3.4/i),s="ucweb"==e.match(/ucweb/i),i="android"==e.match(/android/i),r="windows ce"==e.match(/windows ce/i),c="windows mobile"==e.match(/windows mobile/i),l="micromessenger"==e.match(/MicroMessenger/i);t||n||a||o||s||i||r||c?this.isWeb=!0:l?this.isWebWx=!0:console.log("login.vue--非h5环境")},getOrderData:function(){var t=this;this.$http.post("/mall/app/order/confirm",o({},this.baseInfo,{accountId:this.userInfo.accountId,goodsList:e.getStorageSync("buyList")})).then(function(e){console.log(e),0==e.code?(e.result.address||(t.hasAddress=!1),t.payData=e.result,t.address=e.result.address||{},t.address.addressRecipients=e.result.address&&e.result.address.addressRecipients||"请先去创建地址",e.result.goodsListDetailList.map(function(e){e.mallGoodsId=e.id,t.goodsList.push(e)}),t.fee=e.result.express.fee):console.log("payment.vue-- confirm接口获取数据失败")}).catch(function(e){console.log("payment.vue-- confirm接口获取数据错误"+e)})}},computed:o({},(0,a.mapState)("common",["baseInfo","userInfo"]),{balancePay:function(){return this.payData.totalPrice+this.fee>this.payData.balance?this.payData.balance:this.payData.totalPrice+this.fee},payPrice:function(){return this.balanceType?this.payData.totalPrice+this.fee-this.balancePay:this.payData.totalPrice+this.fee}}),onShow:function(){this.getOrderData()},onLoad:function(e){this.checkEnvironment()}};t.default=i}).call(this,n("543d")["default"])},5664:function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement;e._self._c},o=[];n.d(t,"a",function(){return a}),n.d(t,"b",function(){return o})},a7e6:function(e,t,n){"use strict";n.r(t);var a=n("4cf6"),o=n.n(a);for(var s in a)"default"!==s&&function(e){n.d(t,e,function(){return a[e]})}(s);t["default"]=o.a},b9fb:function(e,t,n){"use strict";n.r(t);var a=n("5664"),o=n("a7e6");for(var s in o)"default"!==s&&function(e){n.d(t,e,function(){return o[e]})}(s);n("1717");var i=n("2877"),r=Object(i["a"])(o["default"],a["a"],a["b"],!1,null,null,null);t["default"]=r.exports}},[["031a","common/runtime","common/vendor"]]]);