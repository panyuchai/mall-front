(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/payment/payment"],{1717:function(e,t,n){"use strict";var s=n("1a9c"),a=n.n(s);a.a},"1a9c":function(e,t,n){},"4cf6":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=n("2f62");function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},s=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(s=s.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),s.forEach(function(t){o(e,t,n[t])})}return e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var r={data:function(){return{hasAddress:!0,isWx:!1,isWebWx:!1,isWeb:!1,remark:"",payData:{},address:{},goodsList:[],balanceType:0,fee:0}},methods:{linkToCoupon:function(){e.redirectTo({url:"/pages/coupon/coupon"})},switchChange:function(e){this.balanceType=Number(e.detail.value)},handleWxPay:function(t){var n=this;this.$http.post("/mall/app/order/submit",a({},t,{payChannels:"8"})).then(function(s){1==s.result.orderState?(e.showToast({icon:"none",title:"订单提交成功"}),e.removeStorageSync("chooseAddress"),setTimeout(function(){e.reLaunch({url:"/pages/order/order"})},1e3)):n.$http.post("/mall/app/order/submit",a({},t,{payChannels:"8",callBackNo:s.result.orderNo})).then(function(e){wx.requestPayment({timeStamp:e.result.payResponse.wxPayResponse.timeStamp,nonceStr:e.result.payResponse.wxPayResponse.nonceStr,package:e.result.payResponse.wxPayResponse.packageStr,signType:e.result.payResponse.wxPayResponse.signType,paySign:e.result.payResponse.wxPayResponse.paySign,success:function(e){console.log(e)},fail:function(e){console.log(e)},complete:function(e){console.log(e)}})}).catch(function(e){console.log(e)})}).catch(function(e){console.log(e)})},handleWxWebPay:function(t){var n=this;this.$http.post("/mall/app/order/submit",a({},t,{payChannels:"6"})).then(function(s){s.result&&1==s.result.orderState?(e.showToast({icon:"none",title:"订单提交成功"}),e.removeStorageSync("chooseAddress"),setTimeout(function(){e.reLaunch({url:"/pages/order/order"})},1e3)):(e.setStorageSync("PAYMENT_ORDER_INFO",JSON.stringify(t)),window.location.href="http://".concat(n.paymentUrl,".yujianli.cn/#/pages/payment/cashRegister?orderNo=")+s.result.orderNo+"&mallDomain=yyy&paymentOrder="+JSON.stringify(t))}).catch(function(e){console.log(e)})},handleWebPay:function(t){var n=this;this.$http.post("/mall/app/order/submit",a({},t,{payChannels:"2"})).then(function(s){1==s.result.orderState?(e.showToast({icon:"none",title:"订单提交成功"}),e.removeStorageSync("chooseAddress"),setTimeout(function(){e.reLaunch({url:"/pages/order/order"})},1e3)):n.$http.post("/mall/app/order/submit",a({},t,{payChannels:"2",callBackNo:s.result.orderNo})).then(function(e){console.log(e)}).catch(function(e){console.log(e)})}).catch(function(e){console.log(e)})},handleSubmit:function(){this.hasAddress||e.showToast({icon:"none",title:"请先去创建地址"});var t=a({},this.baseInfo,{accountId:this.userInfo.accountId,addressId:this.address.addressId,balance:this.balancePay,isBalance:this.balanceType,credits:0,expressFee:this.payData.express.fee,goodsList:this.goodsList,payPrice:this.payPrice,remark:this.remark,totalPrice:this.payData.totalPrice,address:this.address});this.isWx?this.handleWxPay(t):this.isWebWx?this.handleWxWebPay(t):this.isWeb&&this.handleWebPay(t)},checkEnvironment:function(){navigator&&navigator.userAgent?this.browserRedirect():this.isWx=!0},browserRedirect:function(){var e=navigator.userAgent.toLowerCase(),t="micromessenger"==e.match(/MicroMessenger/i);t?this.isWebWx=!0:this.isWeb=!0},getOrderData:function(){var t=this;this.$http.post("/mall/app/order/confirm",a({},this.baseInfo,{accountId:this.userInfo.accountId,goodsList:e.getStorageSync("buyList")})).then(function(n){console.log(n),0==n.code?(n.result.address||(t.hasAddress=!1),t.payData=n.result,t.address=n.result.address||{},t.address.addressRecipients=n.result.address&&n.result.address.addressRecipients||"请先去创建地址",n.result.goodsListDetailList.map(function(e){e.mallGoodsId=e.id,t.goodsList.push(e)}),t.fee=n.result.express.fee,e.getStorageSync("chooseAddress")&&(t.address=e.getStorageSync("chooseAddress"))):console.log("payment.vue-- confirm接口获取数据失败")}).catch(function(e){console.log("payment.vue-- confirm接口获取数据错误"+e)})}},computed:a({},(0,s.mapState)("common",["baseInfo","userInfo","paymentUrl"]),{balancePay:function(){return this.payData.totalPrice+this.fee>this.payData.balance?this.payData.balance:this.payData.totalPrice+this.fee},payPrice:function(){return this.balanceType?this.payData.totalPrice+this.fee-this.balancePay:this.payData.totalPrice+this.fee}}),onShow:function(){this.getOrderData()},onBackPress:function(){e.removeStorageSync("chooseAddress")},onLoad:function(e){this.checkEnvironment()}};t.default=r}).call(this,n("543d")["default"])},a7e6:function(e,t,n){"use strict";n.r(t);var s=n("4cf6"),a=n.n(s);for(var o in s)"default"!==o&&function(e){n.d(t,e,function(){return s[e]})}(o);t["default"]=a.a},b9fb:function(e,t,n){"use strict";n.r(t);var s=n("d06a"),a=n("a7e6");for(var o in a)"default"!==o&&function(e){n.d(t,e,function(){return a[e]})}(o);n("1717");var r=n("2877"),i=Object(r["a"])(a["default"],s["a"],s["b"],!1,null,null,null);t["default"]=i.exports},d06a:function(e,t,n){"use strict";var s=function(){var e=this,t=e.$createElement;e._self._c},a=[];n.d(t,"a",function(){return s}),n.d(t,"b",function(){return a})}},[["031a","common/runtime","common/vendor"]]]);