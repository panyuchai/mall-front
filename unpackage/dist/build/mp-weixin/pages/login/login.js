(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/login/login"],{"0153":function(t,o,n){},"0624":function(t,o,n){"use strict";(function(t){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var e=n("2f62"),i=n("a76c"),a=n("4785");function s(t){for(var o=1;o<arguments.length;o++){var n=null!=arguments[o]?arguments[o]:{},e=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(e=e.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.forEach(function(o){l(t,o,n[o])})}return t}function l(t,o,n){return o in t?Object.defineProperty(t,o,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[o]=n,t}var r=function(){return n.e("components/m-input").then(n.bind(null,"77e2"))},c={components:{mInput:r},data:function(){return{providerList:[],hasProvider:!1,phoneData:{phone:"",code:""},passwordData:{loginName:"",password:""},isMiniprogram:!1,isWx:!1,isWebWx:!1,isPhoneLogin:!1,isPasswordLogin:!1,wxLoginData:{},timeTick:!1,countdown:60}},computed:s({},(0,e.mapState)("common",["mallDomain","mallType","userInfo","baseInfo"]),{showOauthBtn:function(){return this.isMiniprogram}}),methods:s({},(0,e.mapMutations)("common",["SET_TOKEN","SET_HASLOGIN","login","SET_USERIFNO","SET_BASEINFO"]),{handlePhoneLogin:function(){this.isWx?this.bindPhoneLogin():this.isWebWx?this.wxPhoneLogin():this.phoneLogin()},handlePasswordLogin:function(){this.isWx?this.bindPasswordLogin():this.isWebWx?this.wxPasswordLogin():this.passwordLogin()},initProvider:function(){},timeTicking:function(){var t=this,o=setInterval(function(){t.countdown--,t.countdown<0&&(clearInterval(o),t.timeTick=!1)},1e3)},sendCode:function(){var o=this;(0,a.isvalidatemobile)(this.phoneData.phone)[0]?t.showToast({icon:"none",title:(0,a.isvalidatemobile)(this.phoneData.phone)[1]}):this.$http.post("/mall/app/login/mall/verifyCode",s({},this.phoneData,{mallDomain:this.mallDomain})).then(function(n){0==n.code?(t.showToast({icon:"none",title:n.result.content}),o.timeTick=!0,o.timeTicking()):t.showToast({icon:"none",title:"验证码发送失败"})}).catch(function(t){console.log("发送验证码错误"+t)})},phoneLogin:function(){var o=this;(0,a.validatenull)(this.phoneData.code)||(0,a.isvalidatemobile)(this.phoneData.phone)[0]?t.showToast({icon:"none",title:"信息填写有误"}):this.$http.post("/mall/app/login/mall/h5",s({mallDomain:this.mallDomain},this.phoneData)).then(function(n){n.result.isSuccess?(o.SET_HASLOGIN(!0),o.SET_TOKEN(n.result.token),o.$http.setConfig(function(t){return t.header["Authorization"]="Bearer "+(0,i.getStore)({name:"token"}),t}),o.setUserInfo(),t.showToast({icon:"none",title:"登陆成功"}),setTimeout(function(){t.navigateBack({delta:1})},1e3)):(console.log("login-- h5登录失败"),"0011"==n.result.code&&(t.showToast({icon:"none",title:"验证码不正确"}),o.phoneData.code=""))}).catch(function(t){console.log("login-- h5登录错误")})},passwordLogin:function(){var o=this;(0,a.validatenull)(this.passwordData.loginName)||(0,a.validatenull)(this.passwordData.password)?t.showToast({icon:"none",title:"信息填写有误"}):this.$http.post("/mall/app/login/mall/h5",s({mallDomain:this.mallDomain},this.passwordData)).then(function(n){n.result.isSuccess?(o.SET_HASLOGIN(!0),o.SET_TOKEN(n.result.token),o.$http.setConfig(function(t){return t.header["Authorization"]="Bearer "+(0,i.getStore)({name:"token"}),t}),o.setUserInfo(),t.showToast({icon:"none",title:"登陆成功"}),setTimeout(function(){t.navigateBack({delta:1})},1e3)):(console.log("login-- h5登录失败"),"0010"==n.result.code&&(t.showToast({icon:"none",title:"账户密码错误"}),o.passwordData.password=""))}).catch(function(t){console.log("login-- h5登录错误")})},bindPhoneLogin:function(){var o=this;(0,a.validatenull)(this.phoneData.code)||(0,a.isvalidatemobile)(this.phoneData.phone)[0]?t.showToast({icon:"none",title:"信息填写有误"}):this.$http.post("/mall/app/login/mall/wxapp/userinfo",s({mallDomain:this.mallDomain},this.phoneData)).then(function(n){n.result.isSuccess?(o.SET_HASLOGIN(!0),o.SET_TOKEN(n.result.token),o.$http.setConfig(function(t){return t.header["Authorization"]="Bearer "+(0,i.getStore)({name:"token"}),t}),o.setUserInfo(),t.showToast({icon:"none",title:"登陆成功"}),setTimeout(function(){t.navigateBack({delta:1})},1e3)):(console.log("login-- userinfo登录失败"),"0011"==n.result.code&&(t.showToast({icon:"none",title:"验证码不正确"}),o.phoneData.code=""))}).catch(function(t){console.log("login-- userinfo登录错误")})},bindPasswordLogin:function(){var o=this;(0,a.validatenull)(this.passwordData.loginName)||(0,a.validatenull)(this.passwordData.password)?t.showToast({icon:"none",title:"信息填写有误"}):this.$http.post("/mall/app/login/mall/wxapp/userinfo",s({mallDomain:this.mallDomain},this.passwordData)).then(function(n){n.result.isSuccess?(o.SET_HASLOGIN(!0),o.SET_TOKEN(n.result.token),o.$http.setConfig(function(t){return t.header["Authorization"]="Bearer "+(0,i.getStore)({name:"token"}),t}),o.setUserInfo(),t.showToast({icon:"none",title:"登陆成功"}),setTimeout(function(){t.navigateBack({delta:1})},1e3)):(console.log("login-- userinfo登录失败"),"0011"==n.result.code&&(t.showToast({icon:"none",title:"账户密码错误"}),o.passwordData.password=""))}).catch(function(t){console.log("login-- userinfo登录错误")})},wxPhoneLogin:function(){var o=this;(0,a.validatenull)(this.phoneData.code)||(0,a.isvalidatemobile)(this.phoneData.phone)[0]?t.showToast({icon:"none",title:"信息填写有误"}):this.$http.post("/mall/app/login/mall/wxweb/userinfo",s({mallDomain:this.mallDomain},this.phoneData)).then(function(n){n.result.isSuccess?(o.SET_HASLOGIN(!0),o.SET_TOKEN(n.result.token),o.$http.setConfig(function(t){return t.header["Authorization"]="Bearer "+(0,i.getStore)({name:"token"}),t}),o.setUserInfo(),t.showToast({icon:"none",title:"登陆成功"}),setTimeout(function(){t.navigateBack({delta:1})},1e3)):(console.log("login-- wxweb/userinfo登录失败"),"0011"==n.result.code&&(t.showToast({icon:"none",title:"验证码不正确"}),o.phoneData.code=""))}).catch(function(t){console.log("login-- wxweb/userinfo登录错误")})},wxPasswordLogin:function(){var o=this;(0,a.validatenull)(this.phoneData.loginName)||(0,a.validatenull)(this.passwordData.password)?t.showToast({icon:"none",title:"信息填写有误"}):this.$http.post("/mall/app/login/mall/wxweb/userinfo",s({mallDomain:this.mallDomain},this.passwordData)).then(function(n){n.result.isSuccess?(o.SET_HASLOGIN(!0),o.SET_TOKEN(n.result.token),o.$http.setConfig(function(t){return t.header["Authorization"]="Bearer "+(0,i.getStore)({name:"token"}),t}),o.setUserInfo(),t.showToast({icon:"none",title:"登陆成功"}),setTimeout(function(){t.navigateBack({delta:1})},1e3)):(console.log("login-- wxweb/userinfo登录失败"),"0011"==n.result.code&&(t.showToast({icon:"none",title:"账户密码错误"}),o.passwordData.password=""))}).catch(function(t){console.log("login-- wxweb/userinfo登录错误")})},wxLogin:function(){var o=this;t.getSetting({success:function(n){n.authSetting["scope.userInfo"]&&t.getUserInfo({success:function(t){o.wxLoginAjax(t)}})}})},onGotUserInfo:function(t){t.detail.userInfo?this.wxLoginAjax(t.detail):console.log("login.vue-- 用户点击了拒绝授权")},wxLoginAjax:function(o){var n=this,e=o.rawData,a=o.signature,l=o.encryptedData,r=o.iv;this.wxLoginData.rawData=e,this.wxLoginData.signature=a,this.wxLoginData.encryptedData=l,this.wxLoginData.iv=r,this.$http.post("/mall/app/login/mall/wxapp/unionid",s({},this.wxLoginData,{mallDomain:this.mallDomain})).then(function(o){o.result.isSuccess?(t.getUserInfo({success:function(t){n.setUserInfo()}}),n.SET_HASLOGIN(!0),n.SET_TOKEN(o.result.token),n.$http.setConfig(function(t){return t.header["Authorization"]="Bearer "+(0,i.getStore)({name:"token"}),t}),t.navigateBack({delta:1})):(console.log("login.vue--unionid 获取token失败"),"0020"==o.result.code?(n.isMiniprogram=!1,n.isPhoneLogin=!0):"0021"==o.result.code&&(n.isMiniprogram=!1,n.isPasswordLogin=!0))}).catch(function(t){console.log("login.vue--unionid 接口调用出错"+t)})},defaultLogin:function(){this.isMiniprogram&&this.wxLogin()},checkEnvironment:function(){navigator&&navigator.userAgent?this.browserRedirect():(this.isMiniprogram=!0,this.isWx=!0)},browserRedirect:function(){var t=navigator.userAgent.toLowerCase(),o="ipad"==t.match(/ipad/i),n="iphone os"==t.match(/iphone os/i),e="midp"==t.match(/midp/i),i="rv:1.2.3.4"==t.match(/rv:1.2.3.4/i),a="ucweb"==t.match(/ucweb/i),s="android"==t.match(/android/i),l="windows ce"==t.match(/windows ce/i),r="windows mobile"==t.match(/windows mobile/i),c="micromessenger"==t.match(/MicroMessenger/i);if(o||n||e||i||a||s||l||r)switch(this.mallType){case 1:this.isPhoneLogin=!0;break;case 3:this.isPasswordLogin=!0;break;default:console.log("login.vue--未标记商城类型")}else if(c)switch(this.isWebWx=!0,this.mallType){case 1:this.isPhoneLogin=!0;break;case 3:this.isPasswordLogin=!0;break;default:console.log("login.vue--未标记商城类型")}else console.log("login.vue--非h5环境")},setUserInfo:function(){var t=this;this.$http.post("/mall/app/account/info").then(function(o){if(0==o.code){if(o.result){var n=o.result.customer,e=n.accountId,i=n.customerName,a=n.customerSex,s=n.customerImage,l=n.customerId;t.SET_USERIFNO({accountId:e,customerName:i,customerSex:a,customerImage:s,customerId:l})}}else console.log("login.vue-- info接口调用失败")}).catch(function(t){console.log("login.vue-- info接口调用错误")})}}),onReady:function(){this.initProvider(),this.checkEnvironment(),this.defaultLogin()}};o.default=c}).call(this,n("543d")["default"])},"0e4e":function(t,o,n){"use strict";n.r(o);var e=n("0624"),i=n.n(e);for(var a in e)"default"!==a&&function(t){n.d(o,t,function(){return e[t]})}(a);o["default"]=i.a},1256:function(t,o,n){"use strict";var e=n("0153"),i=n.n(e);i.a},8092:function(t,o,n){"use strict";n.r(o);var e=n("a9f4"),i=n("0e4e");for(var a in i)"default"!==a&&function(t){n.d(o,t,function(){return i[t]})}(a);n("1256");var s=n("2877"),l=Object(s["a"])(i["default"],e["a"],e["b"],!1,null,null,null);o["default"]=l.exports},a9f4:function(t,o,n){"use strict";var e=function(){var t=this,o=t.$createElement;t._self._c},i=[];n.d(o,"a",function(){return e}),n.d(o,"b",function(){return i})}},[["a50a","common/runtime","common/vendor"]]]);