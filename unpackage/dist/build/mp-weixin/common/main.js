(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["common/main"],{1893:function(e,o,n){"use strict";var t=n("80d1"),a=n.n(t);a.a},"63a6":function(e,o,n){"use strict";n.r(o);var t=n("6daf"),a=n.n(t);for(var i in t)"default"!==i&&function(e){n.d(o,e,function(){return t[e]})}(i);o["default"]=a.a},"6daf":function(e,o,n){"use strict";(function(e){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var t=n("a76c"),a=n("2f62"),i=n("43d4");function l(e){for(var o=1;o<arguments.length;o++){var n=null!=arguments[o]?arguments[o]:{},t=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.forEach(function(o){s(e,o,n[o])})}return e}function s(e,o,n){return o in e?Object.defineProperty(e,o,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[o]=n,e}var r={computed:l({},(0,a.mapState)("common",["uniCode","mallDomain","baseInfo","hasLogin","firstLoad","baseUrl"])),methods:l({},(0,a.mapMutations)("common",["SET_BASEINFO","SET_USERIFNO","SET_UNICODE","SET_HASLOGIN","SET_TOKEN","SET_MALLTYPE","SET_MALLID","SET_MALLDOMAIN"]),{GetQueryString:function(e){var o=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=window.location.search.substr(1).match(o);return null!=n?unescape(n[2]):null},getMallDomain:function(){var e=this.GetQueryString("mallDomain");this.SET_MALLDOMAIN(e)},checkMallType:function(){var e=this;this.$http.post("/mall/app/login/mall/shopmall/type",{mallDomain:this.mallDomain}).then(function(o){0==o.code?(e.SET_BASEINFO(l({},e.baseInfo,{mallDomain:e.mallDomain,mallType:o.result.type,mallId:o.result.mallId})),e.SET_MALLTYPE(o.result.type),e.SET_MALLID(o.result.mallId)):console.log("login--mallTaye 接口调用失败")}).catch(function(e){console.log("login--mallTaye 接口调用出错")})},initData:function(){e.getStorageSync("hasLogin")&&this.SET_HASLOGIN(e.getStorageSync("hasLogin")),e.getStorageSync("token")&&this.SET_TOKEN(e.getStorageSync("token")),e.getStorageSync("uniCode")&&this.SET_UNICODE(e.getStorageSync("uniCode")),(0,t.getStore)({name:"userInfo"})&&this.SET_USERIFNO((0,t.getStore)({name:"userInfo"}))},browserRedirect:function(e){var o=navigator.userAgent.toLowerCase(),n="micromessenger"==o.match(/MicroMessenger/i);if(!n)return console.log("h5端"),void this.SET_BASEINFO(l({},this.baseInfo,{scm:"pc"}));console.log("wx h5端"),this.SET_BASEINFO(l({},this.baseInfo,{scm:"h5"}));var t=window.location.host;-1==t.indexOf("pay")&&(Boolean(this.hasLogin)||this.defaultwxWebLogin(e))},defaultwxWebLogin:function(o){document.referrer&&e.setStorageSync("referUrl",document.referrer);var n=/\/TransferPage\/TransferPage/gi,t=!n.test(o.path);alert(t),t&&(window.location.href=this.baseUrl+"/mall/app/login/mall/wxweb?mallDomain="+this.mallDomain)},defaultWxLogin:function(){var o=this;e.checkSession({success:function(e){console.log("App.vue--uni.login登陆状态"),o.wxLogin(o.uniCode)},fail:function(n){console.log("App.vue--uni.login登陆已失效"),e.login({provider:"weixin",success:function(e){o.SET_UNICODE(e.code),e.code?o.wxLogin(e.code):console.log("App.vue--获取code失败")}})}})},wxLogin:function(o){var n=this;i.test.post("/mall/app/login/mall/wxapp",{mallDomain:this.mallDomain,jsCode:o}).then(function(o){200==o.statusCode?(e.removeStorageSync("sessionid"),e.setStorageSync("sessionid",o.header["Set-Cookie"]),n.$http.setConfig(function(o){return o.header["cookie"]=e.getStorageSync("sessionid")||"",o}),0==o.data.code?o.data.result.isSuccess?console.log("App.vue--wxapp 登陆成功"):console.log("App.vue--wxapp 登陆失败"):console.log("App.vue--wxapp 接口返回data出错")):console.log("App.vue--wxapp 接口调用失败")}).catch(function(e){console.log("App.vue--wxapp 接口调用出错"+e)})}}),onLaunch:function(e){this.initData(),this.getMallDomain(),this.checkMallType(),navigator&&navigator.userAgent?this.browserRedirect(e):(this.SET_BASEINFO(l({},this.baseInfo,{scm:"wechat"})),Boolean(this.hasLogin)||this.defaultWxLogin())},onShow:function(e){console.log("App Show")},onHide:function(){console.log("App Hide")}};o.default=r}).call(this,n("543d")["default"])},"74d4":function(e,o,n){"use strict";n.r(o);var t=n("63a6");for(var a in t)"default"!==a&&function(e){n.d(o,e,function(){return t[e]})}(a);n("1893");var i,l,s=n("2877"),r=Object(s["a"])(t["default"],i,l,!1,null,null,null);o["default"]=r.exports},"80d1":function(e,o,n){}},[["1544","common/runtime","common/vendor"]]]);